<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Site de Not√≠cias</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-dark mb-4">
    <div class="container-fluid">
        <span class="navbar-brand">üì∞ VB Comunica√ß√£o - Site de Not√≠cias</span>

        <div class="d-flex align-items-center gap-2">

            <!-- ‚úÖ Usu√°rio + tipo -->
            <span class="text-white me-2">
                {{ email_usuario }}
                {% if tipo_usuario %}
                    <span class="badge bg-secondary text-uppercase ms-2">
                        {{ tipo_usuario }}
                    </span>
                {% endif %}
            </span>

            <!-- ‚úÖ Perfil (abre a p√°gina de perfil) -->
            <a href="{% url 'perfil' %}" class="btn btn-outline-light btn-sm">
                üë§ Perfil
            </a>

            <!-- ‚úÖ M√©tricas (s√≥ coordenador) - opcional -->
            {% if is_coordenador %}
                <a href="{% url 'metricas' %}" class="btn btn-outline-info btn-sm">
                    üìä M√©tricas
                </a>
            {% endif %}

            <!-- ‚úÖ Favoritos (s√≥ jornalista) -->
            {% if is_jornalista %}
                <a href="{% url 'noticias_favoritas' %}" class="btn btn-outline-warning btn-sm">
                    ‚≠ê Favoritos
                </a>
            {% endif %}

            <!-- ‚úÖ Logout -->
            <form method="post" action="{% url 'logout' %}" class="m-0">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-light btn-sm">
                    ‚ûú logout
                </button>
            </form>
        </div>
    </div>
</nav>

<div class="container">

    <!-- ‚úÖ Busca -->
    <form method="get" class="d-flex mb-4">
        <input
            type="text"
            name="q"
            value="{{ query }}"
            class="form-control me-2"
            placeholder="Buscar not√≠cias..."
        >
        <button class="btn btn-outline-secondary" type="submit">
            üîç
        </button>
    </form>

    {% for noticia in page_obj %}
        <div class="card mb-3 shadow-sm">
            <div class="card-body">

                <h4>
                    <a href="{% url 'detalhe_noticia' noticia.id %}">
                        {{ noticia.titulo }}
                    </a>
                </h4>

                <p>{{ noticia.conteudo }}</p>

                <!-- ‚úÖ Badge de confiabilidade -->
                {% if noticia.confiavel == True %}
                    <span class="badge bg-success">Confi√°vel</span>
                {% elif noticia.confiavel == False %}
                    <span class="badge bg-danger">N√£o confi√°vel</span>
                {% else %}
                    <span class="badge bg-warning text-dark">N√£o avaliada</span>
                {% endif %}

                <div class="mt-3 d-flex gap-2 flex-wrap">
                    {% if noticia.link %}
                        <a href="{{ noticia.link }}" target="_blank" class="btn btn-primary btn-sm">
                            Ler fonte original
                        </a>
                    {% endif %}

                    <!-- ‚úÖ Favoritar (s√≥ jornalista) -->
                    {% if is_jornalista %}
                        {% if noticia.id in favoritos_ids %}
                            <a href="{% url 'alternar_favorito' noticia.id %}" class="btn btn-warning btn-sm">
                                ‚òÖ Favoritada (remover)
                            </a>
                        {% else %}
                            <a href="{% url 'alternar_favorito' noticia.id %}" class="btn btn-outline-warning btn-sm">
                                ‚òÜ Favoritar
                            </a>
                        {% endif %}
                    {% endif %}

                    <!-- ‚úÖ Editar (s√≥ coordenador) -->
                    {% if is_coordenador %}
                        <a href="{% url 'editar_noticia' noticia.id %}" class="btn btn-warning btn-sm">
                            ‚úèÔ∏è Editar not√≠cia
                        </a>

                        <a href="{% url 'deletar_noticia' noticia.id %}" class="btn btn-danger btn-sm">
                            üóë Deletar
                        </a>
                    {% endif %}
                </div>

            </div>
        </div>
    {% empty %}
        <div class="alert alert-warning">
            Nenhuma not√≠cia cadastrada.
        </div>
    {% endfor %}

    <!-- Pagina√ß√£o -->
    <nav class="mt-4">
        <ul class="pagination">
            {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?q={{ query }}&page={{ page_obj.previous_page_number }}">Anterior</a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">Anterior</span></li>
            {% endif %}

            <li class="page-item disabled">
                <span class="page-link">
                    P√°gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
                </span>
            </li>

            {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?q={{ query }}&page={{ page_obj.next_page_number }}">Pr√≥xima</a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">Pr√≥xima</span></li>
            {% endif %}
        </ul>
    </nav>

</div>

</body>
</html>
